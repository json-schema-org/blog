---
title: "JSON Schemaでクックパッドは複雑なロジックと検証の重複を排除"
date: 2021-12-09T06:00:00+00:00
type: Case Study
cover: /img/posts/2021/cookpad-case-study/cover.webp
authors:
  - name: Ben Hutton
    photo: /img/avatars/benhutton.webp
    link: https://twitter.com/relequestual
excerpt: "クックパッドでJSON Schemaを使用すると、商品登録時の精度とエクスペリエンスが向上し、商品審査にかかる運営上の負担が大幅に軽減されました。"
language: jp
translations:
  en: cookpad-case-study-en
  jp: cookpad-case-study-jp
---

## チャレンジ

クックパッドマートは、クックパッド株式会社が注力している新しい事業のひとつです。これは主に生鮮食品を扱うeコマースプラットフォームであり、町の小売業者や地元の生産者が販売者としてクックパッドマートに参加できます。コンビニエンスストア、ドラッグストア、駅、マンションなど、さまざまな場所に専用冷蔵庫が設置されています。ユーザーはアプリから注文し、専用冷蔵庫から生鮮食品を受け取ることができます。

クックパッドマートは、販売者が商品を登録し、毎日の出荷を運営できる機能を提供する販売者用の管理画面を開発していました。

「商品の種類や状態によって異なる種類のデータを入力する必要がありますが、すべての項目が記載されているフォームから手動で入力する必要がある情報はどれなのでしょう？これを毎回判断するのはとても難しいのです」とクックパッドマートチームのエンジニアである塩出さんは言います。そのため、製品の種類や状態に応じて適切なフォームを選別する仕組みが必要でした。

また、フロントエンドでのフォームの配布をコントロールするだけでは、無効なデータが登録されるのを完全に防ぐことはできません。
社内の運営メンバーが商品の販売開始前に審査を行いますが、商品審査の負担やミスを避けるため、バックエンド側で検証してから登録することが望ましいのです。

## ソリューション

チームはカスタムコードを使用して複雑なフォームを生成することを検討しましたが、ブラウザとサーバー側での検証の一貫性について懸念していました。共通のSchemaを作成するために、メカニズムとしてJSON Schemaが選択されました。「複雑なフォームを分離して検証できるメカニズムとしてJSON Schemaを導入することにしました」と塩田さんは言います。

## 影響

JSON Schemaにより、商品登録時の精度とエクスペリエンスが向上し、商品審査にかかる運営上の負担が大幅に軽減されました。

JSON Schemaを使用することで、要件を変更する負担が軽減されました。「今後新しい要件が増えてもJSON Schemaの定義を更新するだけで解決でき、フロントエンド側のフォームを配布するコントロールロジックの検証とバックエンド側の検証を簡単に実行できるようになります」と塩田さんは述べます。

## 主な影響の結果

<span class="text-3xl">不完全な提出物が10％から0％に。</span>

「以前は、新規登録商品の約10％で品質保証項目の入力が不完全でしたが、JSON Schemaの導入により、品質保証項目に不完全なものがなくなりました」と塩田さんは言います。

## クックパッド

クックパッドは、グローバルなレシピ共有プラットフォームです。世界の76か国で毎月平均1億人のユーザーを誇り、34の言語をサポートし、550万件以上のレシピが共有されています。クックパッドは日本最大のレシピ共有サービスです。

<div class="container flex flex-col sm:flex-row sm:space-x-4 space-y-4 sm:space-y-0 place-content-between">
  <figure class="group m-auto">
  <img class="flex-1" src="/blog/img/posts/2021/cookpad-case-study/fridge.webp" />
  <figcaption class="absolute text-l -mt-6 px-4 bg-gray-600 bg-opacity-50">
  <p class="text-white">クックパッドマートの冷蔵庫</p>
  </figcaption>
  </figure>
  <figure class="group m-auto">
  <img class="flex-1" src="/blog/img/posts/2021/cookpad-case-study/office.webp" />
  <figcaption class="absolute text-l -mt-6 px-4 bg-gray-600 bg-opacity-50">
  <p class="text-white">クックパッドのオフィス</p>
  </figcaption>
  </figure>
</div>

テクノロジー企業であるクックパッドは「毎日の料理を楽しくする」ことに取り組んでいます。クッキングは、人々、地域社会、地球での生活に幸せと健康をもたらす大事なことであると考えているのです。新鮮で高品質の食材を手軽に入手できるようにすることで、クックパッドマートはクッキングをより良い経験にすることができます。

「おいしいものを旬のうちに」は、クックパッドマートの指針のひとつであり、お客様と生産者をよりダイレクトに結び付けることを目指しています。新鮮な食材、おすすめやレシピで、クックパッドがより魅力的なものになります。「新鮮なモッツァレラチーズの本当においしいところは、モチっとした食感なのです」とサンプル商品の一つに記載されています。

小規模生産者が供給する高品質の食材は一般的な店では見つけにくい場合が多く、ほとんどがセルフサービスの出店であるというのが最も賢明なアプローチとなっているのです。クックパッドマートは現在限られた地域でのみご利用いただけますが、お客様が新鮮な食材を入手できるようにすることだけでなく、事業を拡大して商品を一つ一つ審査して承認する手間を減らすことができる機能も重要なのです。

## 開発でのメリット

「バックエンドとフロントエンドのアプリケーションに同じロジックを使用する必要があると考えました。最初は独自のカスタムJSON Structureを作成することを考えましたが、多数の"if"ステートメントを作成する必要があるので、これは避けたいと思っています。」

「JSON Schemaは、バックエンドの検証とフロントエンドのフォーム生成を簡単に実装するのに役立ちます。とても素晴らしい経験でしたね！」と塩田さん。JSON Schemaを使用した結果、検証の構築にかかる時間が半減したと見積もっています。

開発者はDRY「don't repeat yourself（自分を繰り返すな）」という言葉をよく耳にします。「JSON Schemaの定義にのみフォーカスできたので、すべてが自動的に生成されて適用されました。最高の瞬間でしたよ」と塩田さんは語ります。ロジックの重複を減らすことで、クライアント側とサーバー側の間で期待が一致しない可能性が低くなります。

AIは多数の"if"ステートメントと比較されることがよくありますが、経験豊富なアプリケーション開発者は複雑さを軽減してリスクも軽減しようとするのが普通です。多くの条件付きブロックを削除して複雑さを軽減することでコードレビューが簡単になり、継続的なメンテナンスタスクにもプラスの影響を与えました。「エンジニアは"if"ステートメントを可能な限り減らしたいと思っています」と塩田さんは言います。

私たちが目にする多くのJSON Schemaはとてもシンプルなものですが、ドキュメントを読んでくれる人には多大なる力を与えます。「JSON Schemaの語彙には本当に驚きました。タイプや長さなどの単純な式だけでなく、`oneOf`や`If-Then-Else`などの複雑な式もあります」と塩田さんは続けます。

JSON Schemaはかなり前からあることを考えると、条件付きの検証はまだ新しいものです。サブスキーマを適用するための複数のアプローチが理解できるようになると、構成は満足のいく強力なものになります。「JSON Schemaによる豊富な語彙を見つけたとき、JSON Schemaを自信を持って使うことができました。すごくいいです！」塩田さん、本当にそのとおりです！

このケーススタディを共有できるようにしてくれた、エンジニアの塩出さんとクックパッドに感謝いたします。

注：
このケーススタディの一部は、https://techlife.cookpad.com/entry/mart-json-schemaにあるクックパッドによるブログ投稿から引用されました。許可を得て使用しています。
